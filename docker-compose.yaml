version: "2"

volumes:
  database:

services:
  application:
    build:
      context: ./docker
      dockerfile: ./dockerfile
      args:
        SYSTEM_USER_ID: ${SYSTEM_USER_ID}
        SYSTEM_USER_NAME: ${SYSTEM_USER_NAME}
    working_dir: /adserver
    volumes:
    - .:/adserver
    env_file:
      - docker-compose.dev.env

  worker:
    extends:
      service: application
    command: ['php','artisan','queue:work']
    user: ${SYSTEM_USER_ID}

  webserver:
    image: nginx:alpine
    working_dir: /adserver/public
    volumes:
    - ./docker/nginx.conf:/etc/nginx/conf.d/default.conf
    - ./public:/adserver/public

  database:
    image: mysql:8.0
    environment:
    - MYSQL_ROOT_PASSWORD=adshares
    - MYSQL_DATABASE=adserver
    - MYSQL_USER=adserver
    - MYSQL_PASSWORD=adserver
    volumes:
      - database:/var/lib/mysql

  mailer:
    image: mailhog/mailhog:latest
    user: ${SYSTEM_USER_ID}

